#include<Arduino.h>
const char PAGE_SETTINGS[] = "<!DOCTYPE html>\n<html>\n\n<head>\n<title>Doorman Configuration</title>\n<style>\nbody {\nfont-family: Arial, sans-serif;\nmargin: 20px;\n}\n\nh1 {\ntext-align: center;\n}\n\nform {\nmax-width: 500px;\nmargin: 0 auto;\n}\n\ntable {\nwidth: 100%;\nborder-collapse: collapse;\n}\n\nth,\ntd {\npadding: 10px;\ntext-align: left;\n}\n\nth {\nbackground-color: #f2f2f2;\n}\n\ninput[type=\"text\"] {\nwidth: 100%;\npadding: 8px;\nborder: 1px solid #ccc;\nborder-radius: 4px;\nbox-sizing: border-box;\n}\n\ninput[type=\"submit\"] {\nbackground-color: #4CAF50;\ncolor: #fff;\npadding: 10px 20px;\nborder: none;\nborder-radius: 4px;\ncursor: pointer;\nfloat: right;\n}\n\ninput[type=\"submit\"]:hover {\nbackground-color: #45a049;\n}\n\n#feedback {\nmargin-top: 10px;\ncolor: #f00;\ntext-align: center; /* Center the error message */\ndisplay: block; /* Ensure the div behaves as a block-level element */\nwidth: 100%; /* Span the entire width of its parent container */\nclear: both; /* Clear the float after the submit button */\n}\n#version {\nmargin-top: 10px;\ncolor: #000;\ntext-align: center; /* Center the error message */\ndisplay: block; /* Ensure the div behaves as a block-level element */\nwidth: 100%; /* Span the entire width of its parent container */\nclear: both; /* Clear the float after the submit button */\n}\n</style>\n</head>\n\n<body>\n<h1>Doorman Configuration Page</h1>\n<form id=\"configForm\">\n<table>\n<tr>\n<th>Setting</th>\n<th>Value (Hexadecimal)</th>\n</tr>\n<tr>\n<td>Apartment Door Bell Code</td>\n<td><input type=\"text\" name=\"CodeApartmentDoorBell\" maxlength=\"8\" required></td>\n</tr>\n<tr>\n<td>Entry Door Bell Code</td>\n<td><input type=\"text\" name=\"CodeEntryDoorBell\" maxlength=\"8\" required></td>\n</tr>\n<tr>\n<td>Handset Liftup Code</td>\n<td><input type=\"text\" name=\"CodeHandsetLiftup\" maxlength=\"8\" required></td>\n</tr>\n<tr>\n<td>Door Opener Code</td>\n<td><input type=\"text\" name=\"CodeDoorOpener\" maxlength=\"8\" required></td>\n</tr>\n<tr>\n<td>Apartment Door Pattern Detection Code<br />(When this pattern is detected, mqtt message will be sent)</td>\n<td><input type=\"text\" name=\"CodeApartmentPatternDetect\" required></td>\n</tr>\n<tr>\n<td>Entry Door Pattern Detection<br />(When this pattern is detected, door opener will be sent)</td>\n<td><input type=\"text\" name=\"CodeEntryPatternDetect\" maxlength=\"8\" required></td>\n</tr>\n<tr>\n<td>Entry Door Party Mode<br />(When this code is detected, the Door opener code is sent when party mode is enabled)</td>\n<td><input type=\"text\" name=\"CodePartyMode\" maxlength=\"8\" required></td>\n</tr>\n</table>\n<div id=\"feedback\"></div>\n<div id=\"version\"></div>\n<br>\n<input type=\"submit\" value=\"Save Configuration\">\n\n</form>\n<script>\n// Function to fetch and populate the configuration data\nfunction populateConfig() {\n// Fetch the current configuration from the ESP8266\nfetch('/getConfig', {\nmethod: 'GET',\n})\n.then(response => response.json())\n.then(data => {\n// Populate the input fields with the retrieved values\ndocument.getElementById(\"configForm\").elements[\"CodeApartmentDoorBell\"].value = data.CodeApartmentDoorBell.toString(16).padStart(8, '0');\ndocument.getElementById(\"configForm\").elements[\"CodeEntryDoorBell\"].value = data.CodeEntryDoorBell.toString(16).padStart(8, '0');\ndocument.getElementById(\"configForm\").elements[\"CodeHandsetLiftup\"].value = data.CodeHandsetLiftup.toString(16).padStart(8, '0');\ndocument.getElementById(\"configForm\").elements[\"CodeDoorOpener\"].value = data.CodeDoorOpener.toString(16).padStart(8, '0');\ndocument.getElementById(\"configForm\").elements[\"CodeApartmentPatternDetect\"].value = data.CodeApartmentPatternDetect.toString(16).padStart(8, '0');\ndocument.getElementById(\"configForm\").elements[\"CodeEntryPatternDetect\"].value = data.CodeEntryPatternDetect.toString(16).padStart(8, '0');\ndocument.getElementById(\"configForm\").elements[\"CodePartyMode\"].value = data.CodePartyMode.toString(16).padStart(8, '0');\ndocument.getElementById(\"version\").textContent = data.Version;\n\n})\n.catch(error => {\nconsole.error('Error:', error);\nconst feedbackDiv = document.getElementById(\"feedback\");\nfeedbackDiv.textContent = \"An error occurred while fetching the configuration.\";\n});\n}\n\n// Call the function to populate the configuration on page load\nwindow.addEventListener('load', populateConfig);\n\n// Handle form submission\ndocument.getElementById(\"configForm\").onsubmit = function (event) {\nevent.preventDefault(); // Prevent form from submitting normally\n\n// Get form data\nconst formData = new FormData(event.target);\n\n// Convert form data to a JSON object\nconst configData = {};\nformData.forEach((value, key) => {\nconfigData[key] = parseInt(value, 16);\n});\n\n\n// Send the configuration data to the server (ESP8266)\nfetch('/setConfig', {\nmethod: 'POST',\nheaders: {\n'Content-Type': 'application/json'\n},\nbody: JSON.stringify(configData)\n})\n.then(response => response.json())\n.then(data => {\n// Display feedback to the user\nconst feedbackDiv = document.getElementById(\"feedback\");\nfeedbackDiv.textContent = data.message;\n})\n.catch(error => {\nconsole.error('Error:', error);\nconst feedbackDiv = document.getElementById(\"feedback\");\nfeedbackDiv.textContent = \"An error occurred while saving the configuration.\";\n});\n};\n// Validate input fields to accept only hexadecimal numbers\nconst hexInputFields = document.querySelectorAll('input[type=\"text\"]');\nhexInputFields.forEach(field => {\nfield.addEventListener('input', () => {\nconst inputValue = field.value;\nconst isValidHex = /^[0-9a-fA-F]*$/.test(inputValue);\nif (!isValidHex) {\nfield.setCustomValidity(\"Please enter a valid hexadecimal number.\");\n} else {\nfield.setCustomValidity(\"\");\n}\n});\n});\n</script>\n</body>\n\n</html>\n";
